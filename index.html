<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lançador de Chats - Kick</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            padding: 15px;
            font-size: 16px;
        }
        .header { text-align: center; border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 20px; }
        h1 { color: #00ff7f; margin: 0; }
        p { margin: 5px 0 0 0; color: #aaa; }
        #controls { display: flex; justify-content: center; align-items: center; margin-bottom: 20px; gap: 10px; }
        #streamerInput { padding: 10px; border-radius: 5px; border: 1px solid #333; background-color: #222; color: #fff; width: 250px; }
        #addChatBtn { padding: 10px 15px; border: none; background-color: #00ff7f; color: #111; font-weight: bold; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        #addChatBtn:hover { background-color: #00e673; }
        #launcher-container { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 10px; }
        .channel-launcher {
            background-color: #2a2a2a;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 400px;
            transition: border-color 0.5s ease;
        }
        /* Estilo para canais ONLINE */
        .channel-launcher.online {
            border-color: #00ff7f;
            box-shadow: 0 0 8px rgba(0, 255, 127, 0.5);
        }
        .channel-info {
            display: flex;
            align-items: center;
            gap: 10px;
            overflow: hidden;
        }
        .status-dot {
            height: 12px;
            width: 12px;
            background-color: #555; /* Cor padrão (offline) */
            border-radius: 50%;
            flex-shrink: 0;
            transition: background-color 0.5s ease;
        }
        /* Estilo para o status ONLINE */
        .channel-launcher.online .status-dot {
            background-color: #00ff7f;
        }
        .channel-name { 
            font-weight: bold; 
            font-size: 1.1em; 
            color: #eee;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .channel-actions { display: flex; align-items: center; gap: 10px; }
        .launch-btn { background-color: #00ff7f; color: #111; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .close-btn { background-color: #ff4d4d; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Lançador de Chats da Kick</h1>
        <p>Adicione canais e veja quem está online. A lista é atualizada a cada minuto.</p>
    </div>
    
    <div id="controls">
        <input type="text" id="streamerInput" placeholder="Nome do canal...">
        <button id="addChatBtn">Adicionar</button>
    </div>

    <div id="launcher-container">
        </div>

    <script>
        const streamerInput = document.getElementById('streamerInput');
        const addChatBtn = document.getElementById('addChatBtn');
        const launcherContainer = document.getElementById('launcher-container');

        // --- LÓGICA DE STATUS ONLINE ---

        async function checkChannelStatus(channelName) {
            const launcherElement = document.querySelector(`.channel-launcher[data-channel="${channelName}"]`);
            if (!launcherElement) return;

            try {
                // Usamos um proxy para evitar problemas de CORS, se necessário no futuro, mas por agora tentamos direto.
                const response = await fetch(`https://kick.com/api/v2/channels/${channelName}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                if (data.livestream) {
                    // Canal está ONLINE
                    launcherElement.classList.add('online');
                } else {
                    // Canal está OFFLINE
                    launcherElement.classList.remove('online');
                }
            } catch (error) {
                console.error(`Erro ao verificar status de ${channelName}:`, error);
                launcherElement.classList.remove('online'); // Assume offline em caso de erro
            }
        }

        async function updateAllStatuses() {
            console.log("Atualizando status...");
            const launchers = document.querySelectorAll('.channel-launcher');
            const channels = Array.from(launchers).map(launcher => launcher.dataset.channel);

            // Verifica todos os canais em paralelo
            await Promise.all(channels.map(channel => checkChannelStatus(channel)));
            console.log("Status atualizados.");
        }

        // --- LÓGICA DE SALVAMENTO E CRIAÇÃO DE ELEMENTOS ---

        function loadChannels() {
            const savedChannels = JSON.parse(localStorage.getItem('kickLaunchers')) || [];
            savedChannels.forEach(channelName => createLauncherElement(channelName));
            updateAllStatuses(); // Verifica o status logo após carregar os canais
        }

        function saveChannels() {
            const currentChannels = Array.from(document.querySelectorAll('.channel-launcher'))
                                         .map(launcher => launcher.dataset.channel);
            localStorage.setItem('kickLaunchers', JSON.stringify(currentChannels));
        }

        function createLauncherElement(channelName) {
            if (document.querySelector(`.channel-launcher[data-channel="${channelName}"]`)) {
                alert(`O canal ${channelName} já está na lista.`);
                return false;
            }

            const launcherWrapper = document.createElement('div');
            launcherWrapper.className = 'channel-launcher';
            launcherWrapper.dataset.channel = channelName;

            const channelInfo = document.createElement('div');
            channelInfo.className = 'channel-info';

            const statusDot = document.createElement('div');
            statusDot.className = 'status-dot';

            const nameSpan = document.createElement('span');
            nameSpan.className = 'channel-name';
            nameSpan.textContent = channelName;

            channelInfo.appendChild(statusDot);
            channelInfo.appendChild(nameSpan);

            const actionsWrapper = document.createElement('div');
            actionsWrapper.className = 'channel-actions';

            const launchBtn = document.createElement('button');
            launchBtn.className = 'launch-btn';
            launchBtn.textContent = 'Abrir Chat';
            launchBtn.onclick = function() {
                const chatUrl = `https://kick.com/${channelName}/chatroom`;
                window.open(chatUrl, `_blank`, 'width=400,height=600,resizable=yes,scrollbars=yes');
            };

            const closeBtn = document.createElement('button');
            closeBtn.className = 'close-btn';
            closeBtn.textContent = 'X';
            closeBtn.onclick = function() {
                launcherContainer.removeChild(launcherWrapper);
                saveChannels();
            };
            
            actionsWrapper.appendChild(launchBtn);
            actionsWrapper.appendChild(closeBtn);
            
            launcherWrapper.appendChild(channelInfo);
            launcherWrapper.appendChild(actionsWrapper);
            launcherContainer.appendChild(launcherWrapper);
            
            return true;
        }

        function addNewChannel() {
            const streamerName = streamerInput.value.trim().toLowerCase();
            if (streamerName === '') {
                alert('Por favor, digite o nome de um canal.');
                return;
            }
            if (createLauncherElement(streamerName)) {
                saveChannels();
                checkChannelStatus(streamerName); // Verifica o status do novo canal imediatamente
            }
            streamerInput.value = '';
        }

        // --- INICIALIZAÇÃO E EVENTOS ---

        addChatBtn.addEventListener('click', addNewChannel);
        streamerInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') addNewChannel();
        });

        // Carrega os canais salvos quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            loadChannels();
            // Configura o intervalo para atualizar os status a cada 60 segundos (1 minuto)
            setInterval(updateAllStatuses, 60000);
        });
    </script>

</body>
</html>
